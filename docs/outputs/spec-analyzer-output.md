# 반복 일정 기능 요구사항 분석

> **메타데이터**
>
> - Agent: spec-analyzer
> - Status: success
> - Timestamp: 2025-01-30T10:30:00Z
> - Input Source: SPEC_1.md + User Clarifications
> - Output Version: 1.0

## 1. 기능 개요

캘린더 애플리케이션에서 일정을 반복적으로 생성하고 관리하는 기능입니다.

**핵심 특징**:

- 사용자는 일정 생성 시 반복 유형(매일, 매주, 매월, 매년)과 간격을 선택할 수 있음
- 반복 정보만 DB에 저장하고, UI에서 동적으로 반복 일정 인스턴스 생성
- 개별 인스턴스 수정/삭제 또는 전체 반복 일정 수정/삭제 지원
- 특정 엣지 케이스(31일 월간 반복, 2월 29일 연간 반복 등) 명확한 처리 규칙

---

## 2. 기능 요구사항 (Functional Requirements)

### 2.1 반복 유형 선택

#### FR-001: 반복 유형 선택 UI

- **요구사항**: 일정 생성 또는 수정 시 반복 유형을 선택할 수 있어야 함
- **반복 유형 옵션**:
  - `none`: 반복 없음 (일반 일정)
  - `daily`: 매일 반복
  - `weekly`: 매주 반복
  - `monthly`: 매월 반복
  - `yearly`: 매년 반복
- **기준점**: 최초 일정의 날짜가 반복의 기준점이 됨
  - 예시 1: 2025-10-15(수요일)에 일정 생성 → 매주 반복 시 매주 수요일에 생성
  - 예시 2: 2025-01-31에 일정 생성 → 매월 반복 시 매월 31일에만 생성 (31일이 없는 달은 건너뜀)

#### FR-002: 반복 간격 설정

- **요구사항**: 반복 간격(interval)을 사용자가 입력할 수 있어야 함
- **입력 방식**: 숫자 입력 필드
- **기본값**: 1
- **예시**:
  - `interval: 1` + `daily` → 매일 반복
  - `interval: 2` + `daily` → 2일마다 반복
  - `interval: 3` + `weekly` → 3주마다 반복
  - `interval: 2` + `monthly` → 2개월마다 반복

#### FR-003: 반복 종료 날짜 지정

- **요구사항**: 반복 종료 날짜를 선택할 수 있어야 함
- **입력 방식**: 날짜 선택기 (Date Picker)
- **기본값**: 사용자가 입력하지 않으면 2025-12-31로 자동 설정
- **최대값**: 2025-12-31 (예제 특성상 제한)
- **검증**: 종료 날짜는 시작 날짜 이후여야 함

#### FR-004: 반복 일정 겹침 무시

- **요구사항**: 반복 일정 생성 시 기존 일정과의 겹침 검사를 수행하지 않음
- **이유**: 반복 일정은 자동 생성이므로 겹침 검증 제외

---

### 2.2 반복 일정 표시

#### FR-005: 반복 일정 아이콘 표시

- **요구사항**: 캘린더 뷰에서 반복 일정을 시각적으로 구분하여 표시
- **표시 방식**: 반복 일정 아이콘 추가
- **표시 대상**: 모든 반복 일정 인스턴스 (동적으로 생성된 모든 인스턴스)
- **예외**: 단일 수정된 일정은 아이콘 제거

#### FR-006: 반복 일정 동적 생성

- **요구사항**: DB에는 반복 정보만 저장하고, UI 렌더링 시 동적으로 반복 일정 생성
- **저장 방식**: 1개의 Event + RepeatInfo만 DB에 저장
- **표시 방식**: UI에서 RepeatInfo를 기반으로 종료 날짜까지의 모든 인스턴스 생성하여 달력에 표시
- **성능 고려**: 캘린더 뷰에서 보여지는 기간(월 또는 주)에 해당하는 인스턴스만 생성

---

### 2.3 반복 일정 수정

#### FR-007: 반복 일정 수정 모드 선택

- **요구사항**: 반복 일정 수정 시 사용자에게 단일/전체 선택 다이얼로그 표시
- **다이얼로그 텍스트**: "해당 일정만 수정하시겠어요?"
- **옵션**:
  - **예 (단일 수정)**: 해당 인스턴스만 수정
  - **아니오 (전체 수정)**: 모든 반복 일정 수정

#### FR-008: 단일 수정 동작

- **요구사항**: 특정 반복 일정 인스턴스만 수정
- **동작**:
  1. 해당 인스턴스를 독립된 일반 일정으로 변환
  2. 반복 정보(`repeatInfo`) 제거 → `type: 'none'`
  3. 반복 아이콘 제거
  4. 나머지 반복 일정은 그대로 유지
- **데이터 변화**:
  - 기존 반복 일정 유지 (ID 변경 없음)
  - 수정된 인스턴스를 새로운 일반 일정으로 DB에 추가 (새 ID 생성)
- **결과**: 원본 반복 일정 + 독립된 일반 일정 1개

#### FR-009: 전체 수정 동작

- **요구사항**: 모든 반복 일정 인스턴스 수정
- **동작**:
  1. 원본 Event의 모든 필드 업데이트
  2. 반복 정보(`repeatInfo`) 유지
  3. 반복 아이콘 유지
- **데이터 변화**: 원본 Event만 업데이트 (ID 변경 없음)
- **결과**: 모든 인스턴스가 새로운 내용으로 표시됨

---

### 2.4 반복 일정 삭제

#### FR-010: 반복 일정 삭제 모드 선택

- **요구사항**: 반복 일정 삭제 시 사용자에게 단일/전체 선택 다이얼로그 표시
- **다이얼로그 텍스트**: "해당 일정만 삭제하시겠어요?"
- **옵션**:
  - **예 (단일 삭제)**: 해당 인스턴스만 삭제
  - **아니오 (전체 삭제)**: 모든 반복 일정 삭제

#### FR-011: 단일 삭제 동작

- **요구사항**: 특정 반복 일정 인스턴스만 삭제
- **동작**:
  1. 해당 날짜를 예외 목록(`exceptions`)에 추가
  2. 원본 Event는 유지
  3. UI에서 해당 날짜의 인스턴스만 렌더링하지 않음
- **데이터 변화**: 원본 Event의 `repeatInfo.exceptions` 배열에 날짜 추가
- **결과**: 특정 날짜의 인스턴스만 숨겨짐

#### FR-012: 전체 삭제 동작

- **요구사항**: 모든 반복 일정 삭제
- **동작**: 원본 Event를 DB에서 삭제
- **데이터 변화**: 해당 Event 완전 삭제
- **결과**: 모든 반복 일정 인스턴스가 사라짐

---

## 3. 엣지 케이스 (Edge Cases)

### 3.1 월간 반복 특수 날짜 처리

#### EC-001: 31일 월간 반복

- **조건**: 시작 날짜가 31일이고, 월간 반복(`monthly`)을 선택한 경우
- **처리 규칙**: 31일이 있는 달에만 일정 생성
- **건너뛰는 달**: 2월, 4월, 6월, 9월, 11월
- **생성되는 달**: 1월, 3월, 5월, 7월, 8월, 10월, 12월
- **예시**:
  - 시작: 2025-01-31
  - 생성: 2025-01-31, 2025-03-31, 2025-05-31, 2025-07-31, 2025-08-31, 2025-10-31, 2025-12-31
  - 건너뜀: 2025-02, 2025-04, 2025-06, 2025-09, 2025-11

#### EC-002: 30일 월간 반복

- **조건**: 시작 날짜가 30일이고, 월간 반복을 선택한 경우
- **처리 규칙**: 30일이 있는 달에만 일정 생성
- **건너뛰는 달**: 2월만 (평년/윤년 모두)
- **생성되는 달**: 1월, 3월, 4월, 5월, 6월, 7월, 8월, 9월, 10월, 11월, 12월
- **예시**:
  - 시작: 2025-01-30
  - 생성: 2025-01-30, 2025-03-30, 2025-04-30, ..., 2025-12-30
  - 건너뜀: 2025-02

#### EC-003: 29일 월간 반복

- **조건**: 시작 날짜가 29일이고, 월간 반복을 선택한 경우
- **처리 규칙**:
  - 평년 2월: 29일이 없으므로 건너뜀
  - 윤년 2월: 29일이 있으므로 생성
  - 다른 달: 모두 생성
- **예시 (2025년 - 평년)**:
  - 시작: 2025-01-29
  - 생성: 2025-01-29, 2025-03-29, 2025-04-29, ..., 2025-12-29
  - 건너뜀: 2025-02
- **예시 (2024년 - 윤년)**:
  - 시작: 2024-01-29
  - 생성: 2024-01-29, 2024-02-29, 2024-03-29, ..., 2024-12-29
  - 건너뜀: 없음

---

### 3.2 연간 반복 특수 날짜 처리

#### EC-004: 2월 29일 연간 반복

- **조건**: 시작 날짜가 2월 29일(윤년)이고, 연간 반복(`yearly`)을 선택한 경우
- **처리 규칙**: 2월 29일이 있는 해(윤년)에만 일정 생성
- **건너뛰는 해**: 평년 (2025, 2026, 2027 등)
- **생성되는 해**: 윤년 (2024, 2028, 2032 등)
- **예시**:
  - 시작: 2024-02-29
  - 생성: 2024-02-29 (시작), 2028-02-29, 2032-02-29, ...
  - 건너뜀: 2025-02-29, 2026-02-29, 2027-02-29 (해당 날짜 자체가 없음)
- **주의**: 2월 28일이나 3월 1일로 대체하지 않음

---

### 3.3 반복 종료 날짜 경계

#### EC-005: 종료 날짜 경계 처리

- **조건**: 반복 종료 날짜가 지정된 경우
- **처리 규칙**: 종료 날짜를 포함하여 그 이전까지만 일정 생성
- **예시 1** (종료 날짜에 인스턴스 생성):
  - 시작: 2025-01-01, 매일 반복, 종료: 2025-01-10
  - 생성: 2025-01-01, 2025-01-02, ..., 2025-01-10 (10개)
- **예시 2** (종료 날짜에 인스턴스 없음):
  - 시작: 2025-01-01, 매주 반복, 종료: 2025-01-10
  - 생성: 2025-01-01, 2025-01-08 (2개, 2025-01-15는 종료 날짜 이후이므로 생성 안 됨)
- **최대 종료 날짜**: 2025-12-31 (UI에서 제한)

#### EC-006: 기본 종료 날짜 처리

- **조건**: 사용자가 종료 날짜를 입력하지 않은 경우
- **처리 규칙**: 자동으로 2025-12-31로 설정
- **검증**: UI에서 종료 날짜 필드가 비어있으면 백엔드에 전송 전 2025-12-31로 설정

---

### 3.4 주간 반복 요일 처리

#### EC-007: 주간 반복 요일 고정

- **조건**: 주간 반복(`weekly`)을 선택한 경우
- **처리 규칙**: 시작 날짜의 요일에만 반복
- **예시**:
  - 시작: 2025-10-15 (수요일)
  - 생성: 매주 수요일 (2025-10-15, 2025-10-22, 2025-10-29, ...)
  - 생성 안 됨: 다른 요일
- **다중 요일 선택 불가**: 현재 스펙에서는 단일 요일만 지원

---

### 3.5 반복 간격 처리

#### EC-008: 간격(interval)이 1보다 큰 경우

- **조건**: 반복 간격(`interval`)이 2 이상인 경우
- **처리 규칙**: 해당 간격만큼 건너뛰고 생성
- **예시 1** (2일마다):
  - 시작: 2025-01-01, interval: 2, daily
  - 생성: 2025-01-01, 2025-01-03, 2025-01-05, ...
- **예시 2** (3주마다):
  - 시작: 2025-01-01 (수요일), interval: 3, weekly
  - 생성: 2025-01-01, 2025-01-22, 2025-02-12, ...
- **예시 3** (2개월마다 + 31일 엣지 케이스)\*\*:
  - 시작: 2025-01-31, interval: 2, monthly
  - 생성: 2025-01-31, 2025-03-31, 2025-05-31, 2025-07-31, 2025-09-31 (없음 → 건너뜀), 2025-11-31 (없음 → 건너뜀)
  - 최종: 2025-01-31, 2025-03-31, 2025-05-31, 2025-07-31

---

### 3.6 단일 수정/삭제 후 관계

#### EC-009: 단일 수정 후 원본 반복 일정

- **조건**: 반복 일정 인스턴스를 단일 수정한 경우
- **처리 규칙**: 수정된 인스턴스는 완전히 독립되고, 원본 반복 일정은 그대로 유지
- **예시**:
  - 원본: 매일 반복 (2025-01-01 ~ 2025-01-10)
  - 단일 수정: 2025-01-05 인스턴스를 "회의 → 면담"으로 수정
  - 결과:
    - 원본 반복 일정: 2025-01-01, 01-02, 01-03, 01-04, 01-06, 01-07, 01-08, 01-09, 01-10 (제목: 회의)
    - 독립된 일반 일정: 2025-01-05 (제목: 면담, 반복 아이콘 없음)

#### EC-010: 단일 삭제 후 예외 목록

- **조건**: 반복 일정 인스턴스를 단일 삭제한 경우
- **처리 규칙**: 해당 날짜가 예외 목록(`exceptions`)에 추가되고, UI에서 렌더링 제외
- **예시**:
  - 원본: 매일 반복 (2025-01-01 ~ 2025-01-10)
  - 단일 삭제: 2025-01-05, 2025-01-07
  - 결과:
    - DB: `repeatInfo.exceptions: ['2025-01-05', '2025-01-07']`
    - UI 렌더링: 2025-01-01, 01-02, 01-03, 01-04, 01-06, 01-08, 01-09, 01-10

#### EC-011: 단일 수정 후 전체 수정 시도

- **조건**: 단일 수정으로 독립된 일정을 다시 수정하려는 경우
- **처리 규칙**: 일반 일정 수정 플로우로 동작 (단일/전체 선택 다이얼로그 표시 안 됨)
- **이유**: 이미 반복 정보가 제거되어 일반 일정이 되었기 때문

---

## 4. 데이터 모델 요구사항

### 4.1 RepeatInfo 타입

```typescript
interface RepeatInfo {
  type: RepeatType; // 'none' | 'daily' | 'weekly' | 'monthly' | 'yearly'
  interval: number; // 반복 간격 (기본값: 1)
  endDate: string; // 종료 날짜 (ISO 8601 형식: YYYY-MM-DD, 최대: 2025-12-31)
  exceptions?: string[]; // 단일 삭제된 날짜 목록 (ISO 8601 형식: YYYY-MM-DD)
}
```

#### 필드 설명

- **type**: 반복 유형
  - `'none'`: 반복 없음 (일반 일정)
  - `'daily'`: 매일 반복
  - `'weekly'`: 매주 반복 (시작 날짜의 요일 기준)
  - `'monthly'`: 매월 반복 (시작 날짜의 일자 기준)
  - `'yearly'`: 매년 반복 (시작 날짜의 월/일 기준)

- **interval**: 반복 간격
  - 기본값: 1
  - 최소값: 1
  - 예시: 2 → 2일/주/월/년마다 반복

- **endDate**: 반복 종료 날짜
  - 형식: ISO 8601 (YYYY-MM-DD)
  - 최대값: 2025-12-31
  - 기본값: 2025-12-31 (사용자가 입력하지 않은 경우)
  - 검증: 시작 날짜 이후여야 함

- **exceptions** (선택 사항): 단일 삭제된 날짜 목록
  - 형식: ISO 8601 배열 (YYYY-MM-DD)
  - 용도: UI 렌더링 시 해당 날짜의 인스턴스 제외
  - 예시: `['2025-01-05', '2025-01-07']`

---

### 4.2 Event 타입 수정

```typescript
interface Event {
  id: number;
  title: string;
  date: string; // ISO 8601 형식: YYYY-MM-DD
  startTime: string; // HH:mm
  endTime: string; // HH:mm
  description: string;
  location: string;
  category: string;
  repeat: RepeatInfo; // 반복 정보 (기본값: { type: 'none' })
  notificationTime: number; // 분 단위
}
```

#### 주요 변경 사항

- **repeat 필드 추가**: `RepeatInfo` 타입
- **기본값**: `{ type: 'none' }` (일반 일정)
- **반복 일정 여부 확인**: `event.repeat.type !== 'none'`

---

### 4.3 EventForm 타입 수정

```typescript
interface EventForm {
  title: string;
  date: string;
  startTime: string;
  endTime: string;
  description: string;
  location: string;
  category: string;
  isRepeating: boolean; // 반복 일정 여부 토글
  repeatType: RepeatType; // 반복 유형 선택
  repeatInterval: number; // 반복 간격 입력
  repeatEndDate: string; // 종료 날짜 입력
  notificationTime: number;
}
```

#### UI 바인딩

- `isRepeating`: 반복 일정 토글 스위치
- `repeatType`: 반복 유형 선택 드롭다운 (isRepeating이 true일 때만 활성화)
- `repeatInterval`: 간격 숫자 입력 필드
- `repeatEndDate`: 날짜 선택기 (기본값: 2025-12-31)

---

### 4.4 동적 생성을 위한 유틸리티 함수 시그니처

```typescript
/**
 * 반복 일정의 모든 인스턴스를 생성
 * @param event - 원본 Event (반복 정보 포함)
 * @returns 생성된 모든 인스턴스 배열 (각 인스턴스는 독립된 Event 객체)
 */
function generateRepeatInstances(event: Event): Event[];

/**
 * 특정 날짜 범위 내의 반복 일정 인스턴스만 생성 (성능 최적화)
 * @param event - 원본 Event
 * @param startDate - 시작 날짜 (YYYY-MM-DD)
 * @param endDate - 종료 날짜 (YYYY-MM-DD)
 * @returns 해당 범위 내의 인스턴스 배열
 */
function generateRepeatInstancesInRange(event: Event, startDate: string, endDate: string): Event[];

/**
 * 특정 날짜가 반복 일정에서 제외되었는지 확인
 * @param event - 원본 Event
 * @param date - 확인할 날짜 (YYYY-MM-DD)
 * @returns 제외 여부
 */
function isDateExcluded(event: Event, date: string): boolean;

/**
 * 월간 반복 시 해당 날짜가 유효한지 확인 (31일, 30일, 29일 등)
 * @param year - 연도
 * @param month - 월 (1-12)
 * @param day - 일 (1-31)
 * @returns 유효 여부
 */
function isValidDayInMonth(year: number, month: number, day: number): boolean;

/**
 * 윤년 여부 확인
 * @param year - 연도
 * @returns 윤년 여부
 */
function isLeapYear(year: number): boolean;
```

---

## 5. UI/UX 요구사항

### 5.1 반복 일정 생성 플로우

#### UI-001: 반복 일정 토글

- **컴포넌트**: 스위치 또는 체크박스
- **레이블**: "반복 일정"
- **기본값**: `false` (일반 일정)
- **동작**: 활성화 시 반복 설정 UI 표시

#### UI-002: 반복 유형 선택

- **컴포넌트**: 드롭다운 (Select)
- **옵션**:
  - 매일
  - 매주
  - 매월
  - 매년
- **기본값**: "매일"
- **비활성화 조건**: 반복 일정 토글이 꺼져 있을 때

#### UI-003: 반복 간격 입력

- **컴포넌트**: 숫자 입력 필드 (Number Input)
- **레이블**: "반복 간격"
- **기본값**: 1
- **최소값**: 1
- **플레이스홀더**: "1"
- **단위 표시**: "일마다", "주마다", "개월마다", "년마다" (반복 유형에 따라 동적 변경)
- **예시 텍스트**: "2일마다", "3주마다"

#### UI-004: 종료 날짜 선택

- **컴포넌트**: 날짜 선택기 (Date Picker)
- **레이블**: "종료 날짜"
- **기본값**: 2025-12-31
- **최대값**: 2025-12-31
- **최소값**: 시작 날짜 + 1일
- **검증 메시지**: "종료 날짜는 시작 날짜 이후여야 합니다"

---

### 5.2 반복 아이콘 표시 방식

#### UI-005: 아이콘 디자인

- **위치**: 일정 카드 또는 타이틀 옆
- **아이콘**: 순환/반복 아이콘 (예: 🔁, ↻, 또는 MUI의 `<RepeatIcon />`)
- **색상**: 일정 카테고리 색상 또는 중립 색상
- **툴팁**: "반복 일정" (마우스 오버 시)

#### UI-006: 아이콘 표시 조건

- **표시**: `event.repeat.type !== 'none'`인 경우
- **숨김**:
  - `event.repeat.type === 'none'`인 경우
  - 단일 수정으로 독립된 일정이 된 경우

---

### 5.3 수정/삭제 확인 다이얼로그

#### UI-007: 반복 일정 수정 다이얼로그

- **트리거**: 반복 일정 인스턴스 수정 버튼 클릭
- **제목**: "반복 일정 수정"
- **내용**: "해당 일정만 수정하시겠어요?"
- **버튼**:
  - **예**: 단일 수정 (해당 인스턴스만)
  - **아니오**: 전체 수정 (모든 반복 일정)
  - **취소**: 수정 취소

#### UI-008: 반복 일정 삭제 다이얼로그

- **트리거**: 반복 일정 인스턴스 삭제 버튼 클릭
- **제목**: "반복 일정 삭제"
- **내용**: "해당 일정만 삭제하시겠어요?"
- **버튼**:
  - **예**: 단일 삭제 (해당 인스턴스만)
  - **아니오**: 전체 삭제 (모든 반복 일정)
  - **취소**: 삭제 취소

---

### 5.4 캘린더 뷰 표시

#### UI-009: 반복 일정 인스턴스 렌더링

- **방식**: UI 렌더링 시 `generateRepeatInstancesInRange()` 호출하여 동적 생성
- **범위**: 현재 보이는 월/주에 해당하는 인스턴스만 생성 (성능 최적화)
- **정렬**: 날짜 + 시작 시간 순서
- **시각적 구분**: 반복 아이콘으로 일반 일정과 구분

#### UI-010: 예외 날짜 처리

- **조건**: `event.repeat.exceptions` 배열에 포함된 날짜
- **처리**: 해당 날짜의 인스턴스는 렌더링하지 않음
- **예시**: exceptions에 '2025-01-05'가 있으면 1월 5일에는 해당 반복 일정을 표시하지 않음

---

## 6. 검증 규칙 (Validation Rules)

### 6.1 입력 유효성 검사

#### VR-001: 반복 간격 검증

- **규칙**: `interval >= 1`
- **오류 메시지**: "반복 간격은 1 이상이어야 합니다"

#### VR-002: 종료 날짜 검증

- **규칙 1**: `repeatEndDate > event.date`
- **오류 메시지**: "종료 날짜는 시작 날짜 이후여야 합니다"
- **규칙 2**: `repeatEndDate <= '2025-12-31'`
- **오류 메시지**: "종료 날짜는 2025-12-31 이하여야 합니다"

#### VR-003: 반복 유형 검증

- **규칙**: `repeatType in ['daily', 'weekly', 'monthly', 'yearly']`
- **오류 메시지**: "올바른 반복 유형을 선택해주세요"

---

### 6.2 비즈니스 규칙

#### BR-001: 반복 일정 겹침 검사 제외

- **규칙**: 반복 일정 생성 시 기존 일정과의 겹침 검사를 수행하지 않음
- **이유**: 자동 생성되는 반복 일정의 특성상 겹침 허용

#### BR-002: 단일 수정된 일정의 독립성

- **규칙**: 단일 수정된 일정은 원본 반복 일정과 완전히 독립됨
- **결과**: 원본 반복 일정 전체 수정 시 단일 수정된 일정은 영향받지 않음

#### BR-003: 예외 날짜 저장

- **규칙**: 단일 삭제된 날짜는 `exceptions` 배열에 저장되어 UI 렌더링 시 제외
- **형식**: ISO 8601 (YYYY-MM-DD)

---

## 7. 테스트 시나리오 (단위/통합 테스트)

> **참고**: E2E 테스트는 제외하고, 단위 테스트와 통합 테스트만 포함합니다.

---

### 7.1 반복 유형 선택 테스트

#### TS-001: 매일 반복 일정 생성

- **Given**: 2025-01-01에 일정 생성, 반복 유형: 매일, 종료 날짜: 2025-01-10
- **When**: `generateRepeatInstances()` 호출
- **Then**: 2025-01-01 ~ 2025-01-10까지 10개의 인스턴스 생성

#### TS-002: 매주 반복 일정 생성 (수요일 기준)

- **Given**: 2025-10-15(수요일)에 일정 생성, 반복 유형: 매주, 종료 날짜: 2025-11-12
- **When**: `generateRepeatInstances()` 호출
- **Then**: 매주 수요일 인스턴스 생성 (2025-10-15, 10-22, 10-29, 11-05, 11-12)

#### TS-003: 매월 반복 일정 생성 (15일 기준)

- **Given**: 2025-01-15에 일정 생성, 반복 유형: 매월, 종료 날짜: 2025-05-31
- **When**: `generateRepeatInstances()` 호출
- **Then**: 매월 15일 인스턴스 생성 (2025-01-15, 02-15, 03-15, 04-15, 05-15)

#### TS-004: 매년 반복 일정 생성

- **Given**: 2024-03-15에 일정 생성, 반복 유형: 매년, 종료 날짜: 2025-12-31
- **When**: `generateRepeatInstances()` 호출
- **Then**: 매년 3월 15일 인스턴스 생성 (2024-03-15, 2025-03-15)

---

### 7.2 반복 간격 테스트

#### TS-005: 2일마다 반복

- **Given**: 2025-01-01에 일정 생성, 반복 유형: 매일, 간격: 2, 종료 날짜: 2025-01-10
- **When**: `generateRepeatInstances()` 호출
- **Then**: 2025-01-01, 01-03, 01-05, 01-07, 01-09 (5개)

#### TS-006: 3주마다 반복

- **Given**: 2025-01-01(수요일)에 일정 생성, 반복 유형: 매주, 간격: 3, 종료 날짜: 2025-03-31
- **When**: `generateRepeatInstances()` 호출
- **Then**: 2025-01-01, 01-22, 02-12, 03-05, 03-26 (5개, 모두 수요일)

#### TS-007: 2개월마다 반복

- **Given**: 2025-01-15에 일정 생성, 반복 유형: 매월, 간격: 2, 종료 날짜: 2025-12-31
- **When**: `generateRepeatInstances()` 호출
- **Then**: 2025-01-15, 03-15, 05-15, 07-15, 09-15, 11-15 (6개)

---

### 7.3 엣지 케이스: 31일 월간 반복

#### TS-008: 31일 월간 반복 - 기본 케이스

- **Given**: 2025-01-31에 일정 생성, 반복 유형: 매월, 종료 날짜: 2025-12-31
- **When**: `generateRepeatInstances()` 호출
- **Then**:
  - 생성: 2025-01-31, 03-31, 05-31, 07-31, 08-31, 10-31, 12-31 (7개)
  - 건너뜀: 02(28일), 04(30일), 06(30일), 09(30일), 11(30일)

#### TS-009: 31일 2개월마다 반복

- **Given**: 2025-01-31에 일정 생성, 반복 유형: 매월, 간격: 2, 종료 날짜: 2025-12-31
- **When**: `generateRepeatInstances()` 호출
- **Then**: 2025-01-31, 03-31, 05-31, 07-31 (4개, 09-31와 11-31은 없음)

#### TS-010: 윤년 31일 월간 반복

- **Given**: 2024-01-31에 일정 생성, 반복 유형: 매월, 종료 날짜: 2024-12-31
- **When**: `generateRepeatInstances()` 호출
- **Then**:
  - 생성: 2024-01-31, 03-31, 05-31, 07-31, 08-31, 10-31, 12-31 (7개)
  - 건너뜀: 02(29일, 윤년이어도 31일 없음), 04, 06, 09, 11

---

### 7.4 엣지 케이스: 30일 월간 반복

#### TS-011: 30일 월간 반복

- **Given**: 2025-01-30에 일정 생성, 반복 유형: 매월, 종료 날짜: 2025-12-31
- **When**: `generateRepeatInstances()` 호출
- **Then**:
  - 생성: 2025-01-30, 03-30, 04-30, 05-30, 06-30, 07-30, 08-30, 09-30, 10-30, 11-30, 12-30 (11개)
  - 건너뜀: 02(28일)

---

### 7.5 엣지 케이스: 29일 월간 반복

#### TS-012: 29일 월간 반복 (평년)

- **Given**: 2025-01-29에 일정 생성, 반복 유형: 매월, 종료 날짜: 2025-12-31
- **When**: `generateRepeatInstances()` 호출
- **Then**:
  - 생성: 2025-01-29, 03-29, 04-29, 05-29, 06-29, 07-29, 08-29, 09-29, 10-29, 11-29, 12-29 (11개)
  - 건너뜀: 02(28일)

#### TS-013: 29일 월간 반복 (윤년)

- **Given**: 2024-01-29에 일정 생성, 반복 유형: 매월, 종료 날짜: 2024-12-31
- **When**: `generateRepeatInstances()` 호출
- **Then**:
  - 생성: 2024-01-29, 02-29, 03-29, 04-29, 05-29, 06-29, 07-29, 08-29, 09-29, 10-29, 11-29, 12-29 (12개)
  - 건너뜀: 없음

---

### 7.6 엣지 케이스: 2월 29일 연간 반복

#### TS-014: 2월 29일 연간 반복

- **Given**: 2024-02-29에 일정 생성, 반복 유형: 매년, 종료 날짜: 2032-12-31
- **When**: `generateRepeatInstances()` 호출
- **Then**:
  - 생성: 2024-02-29, 2028-02-29, 2032-02-29 (3개, 윤년만)
  - 건너뜀: 2025-02-29, 2026-02-29, 2027-02-29 (평년, 해당 날짜 없음)

---

### 7.7 종료 날짜 경계 테스트

#### TS-015: 종료 날짜 포함 확인

- **Given**: 2025-01-01에 일정 생성, 반복 유형: 매일, 종료 날짜: 2025-01-10
- **When**: `generateRepeatInstances()` 호출
- **Then**: 2025-01-10 인스턴스 포함 (총 10개)

#### TS-016: 종료 날짜 경계 (주간 반복)

- **Given**: 2025-01-01(수요일)에 일정 생성, 반복 유형: 매주, 종료 날짜: 2025-01-10
- **When**: `generateRepeatInstances()` 호출
- **Then**: 2025-01-01, 01-08만 생성 (01-15는 종료 날짜 이후이므로 제외)

#### TS-017: 기본 종료 날짜 설정

- **Given**: 2025-01-01에 일정 생성, 반복 유형: 매일, 종료 날짜 미입력
- **When**: 폼 제출 (submit)
- **Then**: `repeatEndDate`가 자동으로 '2025-12-31'로 설정됨

---

### 7.8 반복 일정 수정 테스트

#### TS-018: 단일 수정 - 독립된 일정으로 변환

- **Given**: 매일 반복 일정 (2025-01-01 ~ 01-10), 2025-01-05 인스턴스 선택
- **When**: "해당 일정만 수정하시겠어요?" → "예" 선택 → 제목 "회의" → "면담"으로 수정
- **Then**:
  - 원본 반복 일정 유지 (ID 변경 없음)
  - 새로운 일반 일정 생성 (ID: 새로 부여, date: 2025-01-05, title: "면담", repeat.type: 'none')
  - 캘린더 뷰:
    - 2025-01-01 ~ 01-04: "회의" (반복 아이콘 O)
    - 2025-01-05: "면담" (반복 아이콘 X)
    - 2025-01-06 ~ 01-10: "회의" (반복 아이콘 O)

#### TS-019: 전체 수정 - 모든 인스턴스 변경

- **Given**: 매일 반복 일정 (2025-01-01 ~ 01-10), 2025-01-05 인스턴스 선택
- **When**: "해당 일정만 수정하시겠어요?" → "아니오" 선택 → 제목 "회의" → "팀 미팅"으로 수정
- **Then**:
  - 원본 Event의 title만 "팀 미팅"으로 업데이트
  - 반복 정보 유지 (repeat.type: 'daily')
  - 캘린더 뷰: 2025-01-01 ~ 01-10 모두 "팀 미팅" (반복 아이콘 O)

#### TS-020: 단일 수정 후 일반 일정 재수정

- **Given**: 단일 수정으로 독립된 일정 (date: 2025-01-05, title: "면담", repeat.type: 'none')
- **When**: 해당 일정 수정 버튼 클릭
- **Then**: 단일/전체 선택 다이얼로그 표시 안 됨 (일반 일정 수정 플로우)

---

### 7.9 반복 일정 삭제 테스트

#### TS-021: 단일 삭제 - 예외 목록에 추가

- **Given**: 매일 반복 일정 (2025-01-01 ~ 01-10), 2025-01-05 인스턴스 선택
- **When**: "해당 일정만 삭제하시겠어요?" → "예" 선택
- **Then**:
  - 원본 Event 유지
  - `repeat.exceptions` 배열에 '2025-01-05' 추가
  - 캘린더 뷰: 01-01 ~ 01-04, 01-06 ~ 01-10만 표시 (01-05 숨김)

#### TS-022: 전체 삭제 - 모든 인스턴스 제거

- **Given**: 매일 반복 일정 (2025-01-01 ~ 01-10), 2025-01-05 인스턴스 선택
- **When**: "해당 일정만 삭제하시겠어요?" → "아니오" 선택
- **Then**:
  - 원본 Event 완전 삭제 (DB에서 제거)
  - 캘린더 뷰: 모든 인스턴스 사라짐

#### TS-023: 여러 날짜 단일 삭제

- **Given**: 매일 반복 일정 (2025-01-01 ~ 01-10)
- **When**:
  - 2025-01-03 인스턴스 단일 삭제
  - 2025-01-07 인스턴스 단일 삭제
- **Then**:
  - `repeat.exceptions: ['2025-01-03', '2025-01-07']`
  - 캘린더 뷰: 01-01, 01-02, 01-04, 01-05, 01-06, 01-08, 01-09, 01-10만 표시

---

### 7.10 반복 아이콘 표시 테스트

#### TS-024: 반복 일정 아이콘 표시

- **Given**: 매일 반복 일정 (2025-01-01 ~ 01-10)
- **When**: 캘린더 뷰 렌더링
- **Then**: 모든 인스턴스에 반복 아이콘 표시

#### TS-025: 단일 수정 후 아이콘 제거

- **Given**: 매일 반복 일정 중 2025-01-05 인스턴스를 단일 수정
- **When**: 캘린더 뷰 렌더링
- **Then**:
  - 2025-01-05: 반복 아이콘 없음
  - 나머지 날짜: 반복 아이콘 표시

#### TS-026: 일반 일정 아이콘 없음

- **Given**: 반복 없는 일반 일정 (repeat.type: 'none')
- **When**: 캘린더 뷰 렌더링
- **Then**: 반복 아이콘 표시 안 됨

---

### 7.11 동적 생성 유틸리티 함수 테스트

#### TS-027: generateRepeatInstances() - 기본 동작

- **Given**: Event { date: '2025-01-01', repeat: { type: 'daily', interval: 1, endDate: '2025-01-05' } }
- **When**: `generateRepeatInstances(event)` 호출
- **Then**: 5개의 인스턴스 배열 반환 (01-01 ~ 01-05)

#### TS-028: generateRepeatInstancesInRange() - 범위 제한

- **Given**: Event { date: '2025-01-01', repeat: { type: 'daily', interval: 1, endDate: '2025-01-31' } }
- **When**: `generateRepeatInstancesInRange(event, '2025-01-10', '2025-01-15')` 호출
- **Then**: 6개의 인스턴스 배열 반환 (01-10 ~ 01-15만)

#### TS-029: isDateExcluded() - 예외 날짜 확인

- **Given**: Event { repeat: { exceptions: ['2025-01-05', '2025-01-07'] } }
- **When**:
  - `isDateExcluded(event, '2025-01-05')` 호출
  - `isDateExcluded(event, '2025-01-06')` 호출
- **Then**:
  - '2025-01-05': `true`
  - '2025-01-06': `false`

#### TS-030: isValidDayInMonth() - 31일 검증

- **When**:
  - `isValidDayInMonth(2025, 1, 31)` (1월 31일)
  - `isValidDayInMonth(2025, 2, 31)` (2월 31일)
  - `isValidDayInMonth(2025, 4, 31)` (4월 31일)
- **Then**:
  - 1월: `true`
  - 2월: `false`
  - 4월: `false`

#### TS-031: isValidDayInMonth() - 2월 29일 검증

- **When**:
  - `isValidDayInMonth(2024, 2, 29)` (윤년)
  - `isValidDayInMonth(2025, 2, 29)` (평년)
- **Then**:
  - 2024: `true`
  - 2025: `false`

#### TS-032: isLeapYear() - 윤년 확인

- **When**:
  - `isLeapYear(2024)` (윤년)
  - `isLeapYear(2025)` (평년)
  - `isLeapYear(2000)` (윤년, 400의 배수)
  - `isLeapYear(1900)` (평년, 100의 배수지만 400의 배수 아님)
- **Then**:
  - 2024: `true`
  - 2025: `false`
  - 2000: `true`
  - 1900: `false`

---

### 7.12 통합 테스트 (Integration Tests)

#### TS-033: 반복 일정 생성 및 표시 (전체 플로우)

- **Given**: 사용자가 일정 생성 폼 열기
- **When**:
  1. 반복 일정 토글 활성화
  2. 반복 유형: 매일, 간격: 1, 종료 날짜: 2025-01-10 입력
  3. 폼 제출
- **Then**:
  1. DB에 Event 1개 저장 (repeat 정보 포함)
  2. 캘린더 뷰에 10개의 인스턴스 표시 (01-01 ~ 01-10)
  3. 모든 인스턴스에 반복 아이콘 표시

#### TS-034: 반복 일정 단일 수정 및 표시 (전체 플로우)

- **Given**: 매일 반복 일정이 이미 생성됨 (2025-01-01 ~ 01-10)
- **When**:
  1. 2025-01-05 인스턴스 클릭
  2. 수정 버튼 클릭
  3. "해당 일정만 수정하시겠어요?" → "예" 선택
  4. 제목 변경 후 저장
- **Then**:
  1. DB에 Event 2개 존재 (원본 반복 일정 + 독립된 일반 일정)
  2. 캘린더 뷰:
  - 01-05: 변경된 제목, 반복 아이콘 없음
  - 나머지: 원래 제목, 반복 아이콘 있음

#### TS-035: 반복 일정 단일 삭제 및 표시 (전체 플로우)

- **Given**: 매일 반복 일정이 이미 생성됨 (2025-01-01 ~ 01-10)
- **When**:
  1. 2025-01-05 인스턴스 클릭
  2. 삭제 버튼 클릭
  3. "해당 일정만 삭제하시겠어요?" → "예" 선택
- **Then**:
  1. DB의 원본 Event에 `repeat.exceptions: ['2025-01-05']` 추가
  2. 캘린더 뷰: 01-01 ~ 01-04, 01-06 ~ 01-10만 표시 (01-05 숨김)

#### TS-036: 31일 월간 반복 생성 및 표시 (전체 플로우)

- **Given**: 사용자가 일정 생성 폼 열기
- **When**:
  1. 시작 날짜: 2025-01-31
  2. 반복 유형: 매월, 간격: 1, 종료 날짜: 2025-12-31
  3. 폼 제출
- **Then**:
  1. DB에 Event 1개 저장
  2. 캘린더 뷰에 7개의 인스턴스 표시 (01-31, 03-31, 05-31, 07-31, 08-31, 10-31, 12-31)
  3. 2월, 4월, 6월, 9월, 11월에는 인스턴스 없음

#### TS-037: 2월 29일 연간 반복 생성 및 표시 (전체 플로우)

- **Given**: 사용자가 일정 생성 폼 열기
- **When**:
  1. 시작 날짜: 2024-02-29
  2. 반복 유형: 매년, 간격: 1, 종료 날짜: 2030-12-31
  3. 폼 제출
- **Then**:
  1. DB에 Event 1개 저장
  2. 캘린더 뷰에 윤년에만 인스턴스 표시 (2024-02-29, 2028-02-29)
  3. 평년(2025, 2026, 2027, 2029, 2030)에는 2월 29일 인스턴스 없음

---

## 8. 구현 고려사항

### 8.1 성능 최적화

#### PERF-001: 동적 생성 범위 제한

- **문제**: 반복 일정이 매일 반복이고 종료 날짜가 먼 미래인 경우, 모든 인스턴스를 생성하면 성능 저하
- **해결**: `generateRepeatInstancesInRange()` 사용하여 현재 보이는 캘린더 뷰 범위(월/주)에 해당하는 인스턴스만 생성

#### PERF-002: 메모이제이션

- **문제**: 동일한 반복 일정에 대해 반복적으로 인스턴스 생성
- **해결**: React `useMemo` 또는 캐싱 메커니즘 사용하여 이미 생성된 인스턴스 재사용

---

### 8.2 데이터 일관성

#### DATA-001: 단일 수정/삭제 시 ID 관리

- **단일 수정**: 새로운 Event 생성 시 고유 ID 부여
- **단일 삭제**: 원본 Event의 `exceptions` 배열에 날짜만 추가 (ID 변경 없음)

#### DATA-002: 예외 날짜 중복 방지

- **검증**: `exceptions` 배열에 이미 존재하는 날짜는 추가하지 않음
- **구현**: `Array.includes()` 또는 `Set` 사용

---

### 8.3 사용자 경험 (UX)

#### UX-001: 반복 간격 입력 명확성

- **문제**: "간격 2"가 무엇을 의미하는지 모호함
- **해결**: 동적 단위 표시 ("2일마다", "3주마다" 등)

#### UX-002: 종료 날짜 기본값 표시

- **문제**: 사용자가 종료 날짜를 입력하지 않으면 어떻게 되는지 불명확
- **해결**: 날짜 선택기에 기본값 2025-12-31 표시 + 도움말 텍스트 ("미입력 시 2025-12-31까지")

#### UX-003: 엣지 케이스 안내

- **문제**: 31일 월간 반복 시 일부 달이 건너뛰어짐을 사용자가 인지하지 못함
- **해결**: 31일 선택 시 경고 메시지 또는 툴팁 표시 ("일부 달은 31일이 없어 건너뛰어집니다")

---

### 8.4 테스트 인프라

#### TEST-001: 고정 시스템 시간

- **현재 설정**: `setupTests.ts`에서 시스템 시간을 '2025-10-01'로 고정
- **주의**: 윤년 관련 테스트 시 2024년 데이터 사용 필요

#### TEST-002: MSW 핸들러 확장

- **필요**: 반복 일정 CRUD API 엔드포인트 모킹
- **경로**: `src/__mocks__/handlers.ts`에 추가

---

## 9. API 요구사항

### 9.1 반복 일정 생성 API

#### API-001: POST /api/events

- **요청 본문**:

```typescript
{
  title: string;
  date: string;
  startTime: string;
  endTime: string;
  description: string;
  location: string;
  category: string;
  repeat: {
    type: 'daily' | 'weekly' | 'monthly' | 'yearly';
    interval: number;
    endDate: string;
  }
  notificationTime: number;
}
```

- **응답**: 생성된 Event (ID 포함)
- **검증**:
  - `repeat.interval >= 1`
  - `repeat.endDate > date`
  - `repeat.endDate <= '2025-12-31'`

---

### 9.2 반복 일정 수정 API

#### API-002: PATCH /api/events/:id (단일 수정)

- **요청 본문**: 수정할 필드 + `repeat: { type: 'none' }`
- **동작**:
  1. 원본 Event 유지
  2. 새로운 Event 생성 (반복 정보 제거)
- **응답**: 생성된 새 Event

#### API-003: PATCH /api/events/:id (전체 수정)

- **요청 본문**: 수정할 필드 (repeat 정보 유지)
- **동작**: 원본 Event 업데이트
- **응답**: 업데이트된 Event

---

### 9.3 반복 일정 삭제 API

#### API-004: DELETE /api/events/:id/instance/:date (단일 삭제)

- **경로 파라미터**:
  - `id`: Event ID
  - `date`: 삭제할 날짜 (YYYY-MM-DD)
- **동작**: 원본 Event의 `repeat.exceptions`에 날짜 추가
- **응답**: 업데이트된 Event

#### API-005: DELETE /api/events/:id (전체 삭제)

- **경로 파라미터**: `id`: Event ID
- **동작**: Event 완전 삭제
- **응답**: 삭제 성공 메시지

---

## 10. 요약

### 10.1 핵심 결정 사항

1. **반복 기준점**: 최초 일정의 날짜 (Q1 답변 A)
2. **종료 날짜**: 선택 입력, 기본값 2025-12-31 (Q2 답변 B)
3. **주간 반복 요일**: 시작 날짜의 요일만 (Q3 답변 A)
4. **반복 간격**: 조정 가능 (Q4 답변 B)
5. **단일 수정 후**: 완전 독립 (Q5 답변 A)
6. **데이터 저장**: 반복 정보만 저장, UI에서 동적 생성 (Q6 답변 A)
7. **반복 아이콘**: 모든 인스턴스에 표시 (Q7 답변 A)
8. **특수 날짜 월간 반복**: 정확히 그 날짜에만 생성 (Q8 답변 A)

---

### 10.2 필수 엣지 케이스 요약

| 엣지 케이스        | 처리 규칙                                              |
| ------------------ | ------------------------------------------------------ |
| 31일 월간 반복     | 31일이 있는 달에만 생성 (1, 3, 5, 7, 8, 10, 12월)      |
| 30일 월간 반복     | 30일이 있는 달에만 생성 (2월 제외)                     |
| 29일 월간 반복     | 29일이 있는 달에만 생성 (평년 2월 제외, 윤년 2월 포함) |
| 2월 29일 연간 반복 | 윤년에만 생성                                          |
| 반복 간격 2 이상   | 해당 간격만큼 건너뛰고 생성                            |
| 단일 수정          | 독립된 일반 일정으로 변환, 반복 아이콘 제거            |
| 단일 삭제          | `exceptions` 배열에 날짜 추가, UI에서 숨김             |
| 종료 날짜 미입력   | 자동으로 2025-12-31 설정                               |

---

### 10.3 다음 단계 (TDD 구현)

1. **RED**: 위 테스트 시나리오를 기반으로 실패하는 테스트 작성
2. **GREEN**: 테스트를 통과하는 최소한의 코드 구현
3. **REFACTOR**: 코드 품질 개선 및 최적화

---

## 부록: 용어 정의

- **반복 일정 (Repeating Event)**: `repeat.type !== 'none'`인 Event
- **일반 일정 (Single Event)**: `repeat.type === 'none'`인 Event
- **인스턴스 (Instance)**: 반복 일정에서 동적으로 생성된 개별 일정 (UI에서만 존재, DB에는 없음)
- **원본 Event (Original Event)**: DB에 저장된 반복 정보를 가진 Event
- **단일 수정 (Single Edit)**: 특정 인스턴스만 수정하여 독립된 일반 일정으로 변환
- **전체 수정 (All Edit)**: 원본 Event를 수정하여 모든 인스턴스 변경
- **단일 삭제 (Single Delete)**: 특정 인스턴스만 숨김 (`exceptions`에 추가)
- **전체 삭제 (All Delete)**: 원본 Event 완전 삭제
- **예외 목록 (Exceptions)**: 단일 삭제된 날짜들의 배열 (`repeat.exceptions`)
- **동적 생성 (Dynamic Generation)**: UI 렌더링 시 RepeatInfo를 기반으로 인스턴스 생성
